<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Implement a Flume Deserializer Plugin to Import XML Files | Xing&#39;s</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="BackgroundFlume is an open-source Apache project, it is a distributed, reliable, and available service for efficiently collecting, aggregating, and moving large amounts of log data. This article shows">
<meta property="og:type" content="article">
<meta property="og:title" content="Implement a Flume Deserializer Plugin to Import XML Files">
<meta property="og:url" content="http://xingwu.me/2014/10/04/Implement-a-Flume-Deserializer-Plugin-to-Import-XML-Files/index.html">
<meta property="og:site_name" content="Xing's">
<meta property="og:description" content="BackgroundFlume is an open-source Apache project, it is a distributed, reliable, and available service for efficiently collecting, aggregating, and moving large amounts of log data. This article shows">
<meta property="og:image" content="http://xingwu.me/images/flume-plugins-project.png">
<meta property="og:updated_time" content="2016-11-27T18:38:35.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Implement a Flume Deserializer Plugin to Import XML Files">
<meta name="twitter:description" content="BackgroundFlume is an open-source Apache project, it is a distributed, reliable, and available service for efficiently collecting, aggregating, and moving large amounts of log data. This article shows">
<meta name="twitter:image" content="http://xingwu.me/images/flume-plugins-project.png">
<meta name="twitter:creator" content="@coolwuxing">
  
    <link rel="alternative" href="/atom.xml" title="Xing&#39;s" type="application/atom+xml">
  
  
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  
  <link href="//fonts.googleapis.com/css?family=Inconsolata:400,700|Open+Sans:700,400" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-43935113-3', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <div id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <div id="header-title">
        <h1 id="logo-wrap">
          <a href="/" id="logo">Xing&#39;s
          
              <span id="subtitle">Coding the Future</span>
          
          </a>
        </h1>
      </div>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://xingwu.me"></form>
      </div>
    </div>
  </div>
</div>
      <div id="main-wrap" class="outer">
        <section id="main"><article id="post-Implement-a-Flume-Deserializer-Plugin-to-Import-XML-Files" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/04/Implement-a-Flume-Deserializer-Plugin-to-Import-XML-Files/" class="article-date">
  <time datetime="2014-10-04T20:50:51.000Z" itemprop="datePublished">Oct 4 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Implement a Flume Deserializer Plugin to Import XML Files
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p><a href="https://flume.apache.org/" target="_blank" rel="external">Flume</a> is an open-source Apache project, it is a distributed, reliable, and available service for efficiently collecting, aggregating, and moving large amounts of log data. This article shows how to import XML Files with Flume, including the development of a deserializer plugin and the corresponding configurations of Flume.
We are using Flume 1.5.0 integrated in MapR.</p>
<p>The secenario is that XML files are sychronized to a directory periodically, we need to config a <strong>Spooling Directory Source</strong> to load these XML files into Flume.</p>
<h2 id="Implement-a-Flume-Deserializer"><a href="#Implement-a-Flume-Deserializer" class="headerlink" title="Implement a Flume Deserializer "></a>Implement a Flume Deserializer </h2><p>The default deserializer of Flume’s <strong>Spooling Directory Source</strong> is <code>LineDeserializer</code>, which simply parses each line as an Flume event. In our case, we need to implement a deserializer for XML files based on the structure.</p>
<a id="more"></a>
<h3 id="Programming-Environment"><a href="#Programming-Environment" class="headerlink" title="Programming Environment"></a>Programming Environment</h3><p>I prefer <a href="http://www.gradle.org/docs/current/userguide/installation.html" target="_blank" rel="external">Gradle</a> as the build automation and Eclispe as the IDE for java programming. 
Please make sure you have them installed.</p>
<p>1. Create a folder for the project and create a <strong><em>build.gradle</em></strong> file using the template below.</p>
<script src="//gist.github.com/0d5716717f2bc7b26515.js?file=build.gradle"></script>
<p>2. Add dependencies to the <strong><em>build.gradle</em></strong>.</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@@ -25,6 +25,8 @@ repositories &#123;</div><div class="line"></div><div class="line"> dependencies &#123;</div><div class="line">     //compile 'commons-collections:commons-collections:3.2'</div><div class="line"><span class="addition">+    compile 'org.apache.flume:flume-ng-sdk:1.5.0'</span></div><div class="line"><span class="addition">+    compile 'org.apache.flume:flume-ng-core:1.5.0'</span></div><div class="line">     testCompile 'junit:junit:4.+'</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>3. Initialize source folders and the Eclipse project.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ gradle initSourceFolders eclipse</div></pre></td></tr></table></figure>
<p>4. Import the project to Eclipse and now you can start coding.</p>
<img src="/images/flume-plugins-project.png" class="align-left" title="Eclipse Project">
<h3 id="Development"><a href="#Development" class="headerlink" title="Development"></a>Development</h3><p>Create a custom deserializer implements the <code>EventDeserializer</code> interface. For instance, here we name it <code>MyXMLDeserializer</code>.
It reads input stream from <code>ResettableInputStream</code> and output <code>List&lt;Event&gt;</code> through the <code>readEvents()</code> function.
<figure class="highlight java"><figcaption><span>MyXMLDeserializer.java </span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.xingwu.flume.plugins;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.flume.Event;</div><div class="line"><span class="keyword">import</span> org.apache.flume.serialization.EventDeserializer;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyXMLDeserializer</span> <span class="keyword">implements</span> <span class="title">EventDeserializer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyXMLDeserializer</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Event <span class="title">readEvent</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="comment">// TODO Auto-generated method stub</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;Event&gt; <span class="title">readEvents</span><span class="params">(<span class="keyword">int</span> numEvents)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="comment">// TODO Auto-generated method stub</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mark</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="comment">// TODO Auto-generated method stub</span></div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="comment">// TODO Auto-generated method stub</span></div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="comment">// TODO Auto-generated method stub</span></div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>It is better to read the XML files as a stream using <code>javax.xml.stream.XMLStreamReader</code> instead of parse the whole file to a XML object and then extract the events. 
So we need to wrap up <code>ResettableInputStream</code> to <code>java.io.InputStream</code> first:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.xingwu.flume.plugins;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.flume.serialization.ResettableInputStream;</div><div class="line"><span class="keyword">import</span> org.slf4j.Logger;</div><div class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlumeInputStream</span> <span class="keyword">extends</span> <span class="title">InputStream</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(FlumeInputStream.class);</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ResettableInputStream in;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FlumeInputStream</span><span class="params">(ResettableInputStream input)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.in = input;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.in.read();</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            logger.error(<span class="string">"input stream read failed:"</span> + e.getMessage());</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now we can start working on the XML parsing and Flume Events generating. Be sure to set the event headers if you get to route the events to different sinks later. </p>
<blockquote>
<p>For details of events routing please refer to <a href="/2014/10/11/Routing-Flume-Events-to-Different-Sinks/">another post</a></p>
</blockquote>
<p>The source code of the deserializer is as below (I changed some class/variable names and I can’t provide the XML structure, but you can get the idea from it):</p>
<figure class="highlight java"><figcaption><span>MyXMLDeserializer.java</span><a href="/downloads/code//MyXMLDeserializer.java">view raw</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.xingwu.flume.plugins;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.nio.charset.Charset;</div><div class="line"><span class="keyword">import</span> java.text.ParseException;</div><div class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.Arrays;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.xml.stream.XMLInputFactory;</div><div class="line"><span class="keyword">import</span> javax.xml.stream.XMLStreamConstants;</div><div class="line"><span class="keyword">import</span> javax.xml.stream.XMLStreamException;</div><div class="line"><span class="keyword">import</span> javax.xml.stream.XMLStreamReader;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.flume.Context;</div><div class="line"><span class="keyword">import</span> org.apache.flume.Event;</div><div class="line"><span class="keyword">import</span> org.apache.flume.annotations.InterfaceAudience;</div><div class="line"><span class="keyword">import</span> org.apache.flume.annotations.InterfaceStability;</div><div class="line"><span class="keyword">import</span> org.apache.flume.event.EventBuilder;</div><div class="line"><span class="keyword">import</span> org.apache.flume.serialization.EventDeserializer;</div><div class="line"><span class="keyword">import</span> org.apache.flume.serialization.ResettableInputStream;</div><div class="line"><span class="keyword">import</span> org.slf4j.Logger;</div><div class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.google.common.base.Joiner;</div><div class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</div><div class="line"><span class="keyword">import</span> com.google.common.collect.Maps;</div><div class="line"></div><div class="line"><span class="meta">@InterfaceAudience</span>.Private</div><div class="line"><span class="meta">@InterfaceStability</span>.Evolving</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyXMLDeserializer</span> <span class="keyword">implements</span> <span class="title">EventDeserializer</span> </span>{</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(MyXMLDeserializer.class);</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ResettableInputStream in;</div><div class="line">    <span class="keyword">private</span> XMLStreamReader r;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Charset outputCharset;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String nullData;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> isOpen;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> generalColumnsIndex = -<span class="number">1</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> inMdScope = <span class="keyword">false</span>, inMvScope = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">private</span> String firstColName = <span class="string">""</span>;</div><div class="line">    <span class="keyword">private</span> String moid = <span class="string">""</span>;</div><div class="line">    <span class="keyword">private</span> List&lt;String&gt; dataCols;</div><div class="line">    <span class="keyword">private</span> List&lt;String&gt; generalCols;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;String&gt; generalColNames;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MYXML_MD_ELEMENT = <span class="string">"md"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MYXML_MV_ELEMENT = <span class="string">"mv"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MYXML_MT_ELEMENT = <span class="string">"mt"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MYXML_MOID_ELEMENT = <span class="string">"moid"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MYXML_R_ELEMENT = <span class="string">"r"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String OUT_CHARSET_KEY = <span class="string">"outputCharset"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CHARSET_DFLT = <span class="string">"UTF-8"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String GENERAL_COLUMNS = <span class="string">"generalColumns"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String GENERAL_COLUMNS_DFLT = <span class="string">"neun,nedn,nesw,mts,gp"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NULL_DATA = <span class="string">"nullData"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NULL_DATA_DFLT = <span class="string">"\\N"</span>;</div><div class="line"></div><div class="line">    MyXMLDeserializer(Context context, ResettableInputStream in) {</div><div class="line">        <span class="keyword">this</span>.in = in;</div><div class="line">        <span class="keyword">this</span>.isOpen = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">this</span>.outputCharset = Charset.forName(context.getString(OUT_CHARSET_KEY, CHARSET_DFLT));</div><div class="line">        <span class="keyword">this</span>.nullData = context.getString(NULL_DATA, NULL_DATA_DFLT);</div><div class="line">        <span class="keyword">this</span>.generalColNames = <span class="keyword">new</span> ArrayList&lt;String&gt;(Arrays.&lt;String&gt; asList(context.getString(</div><div class="line">                GENERAL_COLUMNS, GENERAL_COLUMNS_DFLT).split(<span class="string">","</span>)));</div><div class="line">        XMLInputFactory inputFactory = XMLInputFactory.newInstance();</div><div class="line">        <span class="keyword">try</span> {</div><div class="line">            r = inputFactory.createXMLStreamReader(<span class="keyword">new</span> FlumeInputStream(in));</div><div class="line">        } <span class="keyword">catch</span> (XMLStreamException e) {</div><div class="line">            logger.error(<span class="string">"createXMLStreamReader failed: "</span> + e.getMessage());</div><div class="line">            <span class="keyword">this</span>.isOpen = <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Reads a XML file as a single event</div><div class="line">     * </div><div class="line">     * <span class="doctag">@return</span> Event containing parsed line</div><div class="line">     * <span class="doctag">@throws</span> IOException</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Event <span class="title">readEvent</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</div><div class="line">        logger.error(<span class="string">"Reading a single event from a XML stream is not supported! Try readEvents()!"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Batch line read</div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> numEvents</div><div class="line">     *            Maximum number of events to return.</div><div class="line">     * <span class="doctag">@return</span> List of events containing read lines</div><div class="line">     * <span class="doctag">@throws</span> IOException</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;Event&gt; <span class="title">readEvents</span><span class="params">(<span class="keyword">int</span> numEvents)</span> <span class="keyword">throws</span> IOException </span>{</div><div class="line">        List&lt;Event&gt; events = Lists.newLinkedList();</div><div class="line">        ensureOpen();</div><div class="line">        String output = <span class="string">""</span>;</div><div class="line">        <span class="keyword">try</span> {</div><div class="line">            <span class="keyword">int</span> event = r.getEventType();</div><div class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) {</div><div class="line">                <span class="keyword">switch</span> (event) {</div><div class="line">                <span class="keyword">case</span> XMLStreamConstants.START_DOCUMENT:</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line"></div><div class="line">                <span class="keyword">case</span> XMLStreamConstants.START_ELEMENT:</div><div class="line"></div><div class="line">                    <span class="comment">// activate scope</span></div><div class="line">                    String strEleName = r.getName().getLocalPart();</div><div class="line">                    <span class="keyword">if</span> (inMdScope) {</div><div class="line">                        <span class="keyword">if</span> (inMvScope) {</div><div class="line">                            <span class="keyword">if</span> (strEleName.equals(MYXML_MOID_ELEMENT)) {</div><div class="line">                                moid = r.getElementText();</div><div class="line">                            } <span class="keyword">else</span> <span class="keyword">if</span> (strEleName.equals(MYXML_R_ELEMENT)) {</div><div class="line">                                String dataCell = r.getElementText();</div><div class="line">                                <span class="keyword">if</span> (dataCell == <span class="keyword">null</span> || dataCell.isEmpty()) {</div><div class="line">                                    dataCell = <span class="keyword">this</span>.nullData;</div><div class="line">                                }</div><div class="line">                                dataCols.add(dataCell);</div><div class="line">                            }</div><div class="line">                        } <span class="keyword">else</span> <span class="keyword">if</span> (strEleName.equals(MYXML_MV_ELEMENT)) {</div><div class="line">                            inMvScope = <span class="keyword">true</span>;</div><div class="line">                            dataCols = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">                        } <span class="keyword">else</span> <span class="keyword">if</span> (strEleName.equals(MYXML_MT_ELEMENT)) {</div><div class="line">                            <span class="keyword">if</span> (firstColName.isEmpty()) {</div><div class="line">                                firstColName = r.getElementText();</div><div class="line">                            }</div><div class="line">                        } <span class="keyword">else</span> {</div><div class="line">                            generalColumnsIndex = generalColNames.indexOf(strEleName);</div><div class="line">                            <span class="keyword">if</span> (generalColumnsIndex &gt;= <span class="number">0</span></div><div class="line">                                    &amp;&amp; generalColumnsIndex &lt;= generalColNames.size()) {</div><div class="line">                                generalCols.set(generalColumnsIndex, r.getElementText());</div><div class="line">                            }</div><div class="line">                        }</div><div class="line">                    } <span class="keyword">else</span> <span class="keyword">if</span> (strEleName.equals(MYXML_MD_ELEMENT)) {</div><div class="line">                        inMdScope = <span class="keyword">true</span>;</div><div class="line">                        <span class="comment">// initialize general columns for each md</span></div><div class="line">                        generalCols = <span class="keyword">new</span> ArrayList&lt;String&gt;(generalColNames);</div><div class="line">                    }</div><div class="line"></div><div class="line">                    <span class="keyword">break</span>;</div><div class="line"></div><div class="line">                <span class="keyword">case</span> XMLStreamConstants.CHARACTERS:</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line"></div><div class="line">                <span class="keyword">case</span> XMLStreamConstants.END_ELEMENT:</div><div class="line"></div><div class="line">                    <span class="comment">// close scope</span></div><div class="line">                    String strEndEle = r.getName().getLocalPart();</div><div class="line"></div><div class="line">                    <span class="keyword">if</span> (strEndEle.equals(MYXML_MD_ELEMENT)) {</div><div class="line">                        inMdScope = <span class="keyword">false</span>;</div><div class="line">                        firstColName = <span class="string">""</span>;</div><div class="line">                    } <span class="keyword">else</span> <span class="keyword">if</span> (strEndEle.equals(MYXML_MV_ELEMENT)) {</div><div class="line">                        inMvScope = <span class="keyword">false</span>;</div><div class="line">                        <span class="comment">// build event</span></div><div class="line"></div><div class="line">                        output = Joiner.on(<span class="string">"|"</span>).useForNull(<span class="keyword">this</span>.nullData).join(generalCols) + <span class="string">"|"</span></div><div class="line">                                + moid + <span class="string">"|"</span></div><div class="line">                                + Joiner.on(<span class="string">"|"</span>).useForNull(<span class="keyword">this</span>.nullData).join(dataCols);</div><div class="line">                        Event objEvent = EventBuilder.withBody(output, outputCharset);</div><div class="line">                        Map&lt;String, String&gt; headers = generateHeaders(generalColNames, generalCols);</div><div class="line">                        headers.put(<span class="string">"firstCol"</span>, firstColName);</div><div class="line">                        objEvent.setHeaders(headers);</div><div class="line">                        events.add(objEvent);</div><div class="line">                        moid = <span class="string">""</span>;</div><div class="line">                    }</div><div class="line"></div><div class="line">                    <span class="keyword">break</span>;</div><div class="line"></div><div class="line">                <span class="keyword">case</span> XMLStreamConstants.END_DOCUMENT:</div><div class="line"></div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (!r.hasNext())</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line"></div><div class="line">                event = r.next();</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (events.size() &gt;= numEvents) {</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        } <span class="keyword">catch</span> (XMLStreamException e) {</div><div class="line">            logger.error(e.getMessage());</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> events;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mark</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</div><div class="line">        ensureOpen();</div><div class="line">        in.mark();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</div><div class="line">        ensureOpen();</div><div class="line">        in.reset();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</div><div class="line">        <span class="keyword">if</span> (isOpen) {</div><div class="line">            reset();</div><div class="line">            in.close();</div><div class="line">            <span class="keyword">try</span> {</div><div class="line">                r.close();</div><div class="line">            } <span class="keyword">catch</span> (XMLStreamException e) {</div><div class="line">                logger.error(<span class="string">"XML close error: "</span> + e.getMessage());</div><div class="line">            }</div><div class="line">            isOpen = <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> Map&lt;String, String&gt; <span class="title">generateHeaders</span><span class="params">(List&lt;String&gt; keys, List&lt;String&gt; values)</span> </span>{</div><div class="line">        Map&lt;String, String&gt; map = Maps.newHashMap();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; keys.size(); i++) {</div><div class="line">            <span class="keyword">if</span> (keys.get(i).equals(<span class="string">"mts"</span>)) {</div><div class="line">                Date d;</div><div class="line">                <span class="keyword">try</span> {</div><div class="line">                    d = (<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMddHHmmssX"</span>).parse(values.get(i)));</div><div class="line">                    map.put(<span class="string">"timestamp"</span>, String.valueOf(d.getTime()));</div><div class="line">                } <span class="keyword">catch</span> (ParseException e) {</div><div class="line">                    logger.error(<span class="string">"Parse timestamp error: "</span> + e.getMessage());</div><div class="line">                }</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                map.put(keys.get(i), values.get(i));</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span> map;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureOpen</span><span class="params">()</span> </span>{</div><div class="line">        <span class="keyword">if</span> (!isOpen) {</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Serializer has been closed"</span>);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> <span class="keyword">implements</span> <span class="title">EventDeserializer</span>.<span class="title">Builder</span> </span>{</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> EventDeserializer <span class="title">build</span><span class="params">(Context context, ResettableInputStream in)</span> </span>{</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> MyXMLDeserializer(context, in);</div><div class="line">        }</div><div class="line"></div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>
<h3 id="Unittest"><a href="#Unittest" class="headerlink" title="Unittest"></a>Unittest</h3><p>We can build a unittest file and run as <em>JUnit Test</em>:</p>
<figure class="highlight java"><figcaption><span>MyXMLDeserializerTest.java</span><a href="/downloads/code//MyXMLDeserializerTest.java">view raw</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.xingwu.flume.plugins;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.File;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.apache.flume.Context;</div><div class="line"><span class="keyword">import</span> org.apache.flume.Event;</div><div class="line"><span class="keyword">import</span> org.apache.flume.serialization.DurablePositionTracker;</div><div class="line"><span class="keyword">import</span> org.apache.flume.serialization.EventDeserializer;</div><div class="line"><span class="keyword">import</span> org.apache.flume.serialization.PositionTracker;</div><div class="line"><span class="keyword">import</span> org.apache.flume.serialization.ResettableFileInputStream;</div><div class="line"><span class="keyword">import</span> org.apache.flume.serialization.ResettableInputStream;</div><div class="line"><span class="keyword">import</span> org.junit.After;</div><div class="line"><span class="keyword">import</span> org.junit.AfterClass;</div><div class="line"><span class="keyword">import</span> org.junit.Before;</div><div class="line"><span class="keyword">import</span> org.junit.BeforeClass;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">import</span> org.slf4j.Logger;</div><div class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</div><div class="line"></div><div class="line"><span class="keyword">import</span> me.xingwu.flume.plugins.MyXMLDeserializer;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyXMLDeserializerTest</span> </span>{</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> CLEANUP = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(MyXMLDeserializerTest.class);</div><div class="line"></div><div class="line">    <span class="keyword">private</span> File file, meta;</div><div class="line"></div><div class="line">    <span class="meta">@Before</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</div><div class="line">        file = <span class="keyword">new</span> File(<span class="string">"target/test2.xml"</span>).getAbsoluteFile();</div><div class="line">        logger.info(<span class="string">"Data file: {}"</span>, file);</div><div class="line">        meta = File.createTempFile(<span class="string">"test"</span>, <span class="string">".avro"</span>);</div><div class="line">        logger.info(<span class="string">"PositionTracker meta file: {}"</span>, meta);</div><div class="line">        meta.delete(); <span class="comment">// We want the filename but not the empty file</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="meta">@After</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tearDown</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</div><div class="line">        <span class="keyword">if</span> (CLEANUP) {</div><div class="line">            meta.delete();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="meta">@BeforeClass</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setUpBeforeClass</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="meta">@AfterClass</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tearDownAfterClass</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testReadEvents</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</div><div class="line">        PositionTracker tracker = DurablePositionTracker.getInstance(meta, file.getPath());</div><div class="line">        ResettableInputStream in = <span class="keyword">new</span> ResettableFileInputStream(file, tracker);</div><div class="line">        List&lt;Event&gt; events;</div><div class="line"></div><div class="line">        EventDeserializer des = <span class="keyword">new</span> MyXMLDeserializer(<span class="keyword">new</span> Context(), in);</div><div class="line">        events = des.readEvents(<span class="number">650</span>);</div><div class="line">        System.out.println(<span class="string">"Event: "</span> + events.size());</div><div class="line">        <span class="keyword">for</span> (Event e : events) {</div><div class="line">            System.out.println(<span class="string">"Event: &lt;"</span> + e.getHeaders().get(<span class="string">"firstCol"</span>) + <span class="string">"&gt;"</span></div><div class="line">                    + <span class="keyword">new</span> String(e.getBody()));</div><div class="line">        }</div><div class="line">        des.close();</div><div class="line">    }</div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>
<h3 id="Build-and-Deployment"><a href="#Build-and-Deployment" class="headerlink" title="Build and Deployment"></a>Build and Deployment</h3><p>Run <code>gradle build</code> then you can find the lib at <code>build/libs/the-package-name-0.1.0.jar</code>.
You can change the jar name and version in the <strong><em>build.grale</em></strong>.</p>
<p>For the deployment, simply put the jar in <code>$FLUME_HOME/plugins.d/ANY_NAME_YOU_LIKE/lib/</code> and configure the Flume this way:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># Source</div><div class="line">agent.sources = helloXMLs</div><div class="line">agent.sources.helloXMLs.type = spooldir</div><div class="line">agent.sources.helloXMLs.spoolDir = /opt/data/spooltest</div><div class="line">agent.sources.helloXMLs.deletePolicy = immediate</div><div class="line">agent.sources.helloXMLs.deserializer = me.xingwu.flume.plugins.MyXMLDeserializer$Build</div></pre></td></tr></table></figure>
<p>Make sure you put a <code>$Build</code> after your class name, or you will get an error like this:</p>
<blockquote>
<p>org.apache.flume.FlumeException: Unable to instantiate Builder from me.xingwu.flume.plugins.MyXMLDeserializer: does not appear to implement org.apache.flume.serialization.EventDeserializer$Builder</p>
</blockquote>
<p>Now the XML source has been set up! Configure channels and sinks for Flume and enjoy! Leave a comment if you get any questions :)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xingwu.me/2014/10/04/Implement-a-Flume-Deserializer-Plugin-to-Import-XML-Files/" data-id="cixny1n3n000607pgddlypqkw" class="article-share-link">Share</a>
      
        <a href="http://xingwu.me/2014/10/04/Implement-a-Flume-Deserializer-Plugin-to-Import-XML-Files/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Big-Data/">Big Data</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flume/">Flume</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/10/07/Load-Data-to-Hive-Using-Flume/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Load Data to Hive Using Flume
        
      </div>
    </a>
  
  
    <a href="/2014/09/21/MapR-M3-Single-node-Cluster-Installation-on-CentOS-6/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">MapR M3 Single-node Cluster Installation on CentOS 6</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          
            <aside id="sidebar" class="fixed">
    <div class="widget-wrap fixed">
    <h3 class="widget-title">Anchors</h3>

    <div class="widget">
        <ul class='toc'>
        <li><a class='anchor' href='#logo'>Title</a></li>
        <li><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Background"><span class="toc-number">1.</span> <span class="toc-text">Background</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Implement-a-Flume-Deserializer"><span class="toc-number">2.</span> <span class="toc-text">Implement a Flume Deserializer </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Programming-Environment"><span class="toc-number">2.1.</span> <span class="toc-text">Programming Environment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Development"><span class="toc-number">2.2.</span> <span class="toc-text">Development</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unittest"><span class="toc-number">2.3.</span> <span class="toc-text">Unittest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Build-and-Deployment"><span class="toc-number">2.4.</span> <span class="toc-text">Build and Deployment</span></a></li></ol></li></ol></li>
        <li><a class='anchor' href='#comments'>Comments</a></li> 
        </ul>
    </div>
</div>
    
    <div class="widget-wrap">
      <h3 class="widget-title">Related</h3>
      <div class="widget recents">
        <ul>
  
    <li>
      <a href="/2014/10/11/Implement-Spark-Streaming-Applications-in-Java/">Implement Spark Streaming Applications in Java</a>
    </li>
  
    <li>
      <a href="/2014/10/07/Load-Data-to-Hive-Using-Flume/">Load Data to Hive Using Flume</a>
    </li>
  
    <li>
      <a href="/2014/10/11/Routing-Flume-Events-to-Different-Sinks/">Routing Flume Events to Multiple Sinks</a>
    </li>
  
    <li>
      <a href="/2014/10/15/Spark-Streaming-Troubleshooting/">Spark Streaming Troubleshooting</a>
    </li>
  
        </ul>
      </div>
    </div>

</aside>
          
        
      </div>
      <div id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a></br>
      &copy; 2017 Xing Wu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</div>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'xingwu';
  
  var disqus_url = 'http://xingwu.me/2014/10/04/Implement-a-Flume-Deserializer-Plugin-to-Import-XML-Files/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

    <a href='#logo' id='btn-btt'>^</a>
  </div>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Real-time Web Dashboard Using Socket.io and Highcharts | Xing&#39;s</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="The traditional way to accomplish a real-time web dashboard is through automatically refreshing charts or long polling ajax requests. 
Socket.io is a Node.js library provides a duplex communication me">
<meta property="og:type" content="article">
<meta property="og:title" content="Real-time Web Dashboard Using Socket.io and Highcharts">
<meta property="og:url" content="http://xingwu.me/2014/10/19/Real-time-Web-Dashboard-Using-Socket-io-and-Highcharts/index.html">
<meta property="og:site_name" content="Xing's">
<meta property="og:description" content="The traditional way to accomplish a real-time web dashboard is through automatically refreshing charts or long polling ajax requests. 
Socket.io is a Node.js library provides a duplex communication me">
<meta property="og:updated_time" content="2017-01-08T00:48:22.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Real-time Web Dashboard Using Socket.io and Highcharts">
<meta name="twitter:description" content="The traditional way to accomplish a real-time web dashboard is through automatically refreshing charts or long polling ajax requests. 
Socket.io is a Node.js library provides a duplex communication me">
<meta name="twitter:creator" content="@coolwuxing">
  
    <link rel="alternative" href="/atom.xml" title="Xing&#39;s" type="application/atom+xml">
  
  
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  
  <link href="//fonts.googleapis.com/css?family=Inconsolata:400,700|Open+Sans:700,400" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-43935113-3', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <div id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <div id="header-title">
        <h1 id="logo-wrap">
          <a href="/" id="logo">Xing&#39;s
          
              <span id="subtitle">Coding the Future</span>
          
          </a>
        </h1>
      </div>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://xingwu.me"></form>
      </div>
    </div>
  </div>
</div>
      <div id="main-wrap" class="outer">
        <section id="main"><article id="post-Real-time-Web-Dashboard-Using-Socket-io-and-Highcharts" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/19/Real-time-Web-Dashboard-Using-Socket-io-and-Highcharts/" class="article-date">
  <time datetime="2014-10-20T03:28:19.000Z" itemprop="datePublished">Oct 19 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Real-time Web Dashboard Using Socket.io and Highcharts
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>The traditional way to accomplish a real-time web dashboard is through automatically refreshing charts or long polling ajax requests. 
<a href="http://socket.io" target="_blank" rel="external">Socket.io</a> is a Node.js library provides a duplex communication method between browsers and web servers using <a href="http://en.wikipedia.org/wiki/WebSocket" target="_blank" rel="external">WebSocket</a>.
And as for those outdated clients that not support WebSocket, it can automatically fallback to traditional polling mechanisms. 
This article is a guide to implement a real-time web dashboard using Socket.io. You may need some basic knowledge about <a href="http://nodejs.org/" target="_blank" rel="external">Node.js</a> for better understanding.</p>
<a id="more"></a>
<h1 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h1><p>Let us start with an example, a single chart that automatically updates in real-time. In this example, the data is stored in MySQL. </p>
<h2 id="Server-Side"><a href="#Server-Side" class="headerlink" title="Server Side"></a>Server Side</h2><p>The server should keep data updated and push data to client. 
Clients need two types of data: <strong>(1)</strong> complete data points for the chart when first connects to the server, <strong>(2)</strong> and updated data points for the chart after connected.</p>
<p>If you are using traditional databases like MySQL, you can query and cache the data every second like the following example. 
But I highly recommend <a href="http://redis.io/" target="_blank" rel="external">Redis</a> as the storage system of real-time dashboards, you can store all your data that need real-time visualization in Redis. 
Redis has a feature named <code>SUBSCRIBE</code>, with which clients will be notified when data changes so that you donâ€™t need to query periodically.</p>
<figure class="highlight javascript"><figcaption><span>app.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'http'</span>).Server();</div><div class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(app);</div><div class="line"><span class="keyword">var</span> debug = <span class="built_in">require</span>(<span class="string">'debug'</span>)(<span class="string">'realdash'</span>);</div><div class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</div><div class="line"></div><div class="line"><span class="comment">// Connection configuration</span></div><div class="line"><span class="keyword">var</span> conn = mysql.createConnection(&#123;</div><div class="line">    <span class="attr">host</span>: <span class="string">'xx.xx.xx.xx'</span>,</div><div class="line">    <span class="attr">user</span>: <span class="string">'xxx'</span>,</div><div class="line">    <span class="attr">password</span>: <span class="string">'xxx'</span>,</div><div class="line">    <span class="attr">database</span>: <span class="string">'xxx'</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// merge new data to cache, return the diff</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mergediff</span>(<span class="params">orig_data, new_data</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> diff = &#123;<span class="attr">needUpdate</span>:<span class="literal">false</span>, <span class="attr">data</span>:&#123;&#125;&#125;;</div><div class="line">    <span class="keyword">var</span> diff_data = diff.data;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> new_data) &#123;</div><div class="line">        <span class="keyword">if</span> (!orig_data.hasOwnProperty(key)</div><div class="line">         || <span class="built_in">JSON</span>.stringify(orig_data[key])!== <span class="built_in">JSON</span>.stringify(new_data[key])) &#123;</div><div class="line">            diff.needUpdate = <span class="literal">true</span>;</div><div class="line">            orig_data[key] = new_data[key];</div><div class="line">            diff_data[key] = new_data[key];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="built_in">Object</span>.keys(orig_data).length &gt; <span class="number">50</span>) &#123;</div><div class="line">        <span class="keyword">var</span> ordered = <span class="built_in">Object</span>.keys(orig_data).sort();</div><div class="line">        <span class="keyword">var</span> delNum = ordered.length - <span class="number">50</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; delNum; i++) &#123;</div><div class="line">            <span class="keyword">delete</span> orig_data[ordered[i]];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> diff;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// this is the query loop.</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataSync</span>(<span class="params">conn, orig_data, lastUpdate</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> queryString = mysql.format(<span class="string">"select `time`,value,updateTime from `KPI` where network='vzwca' and "</span> +</div><div class="line">        <span class="string">"`kpi`='xxx' and updateTime &gt; ? order by `time` desc limit 50"</span>, lastUpdate);</div><div class="line">    conn.query(queryString, <span class="function"><span class="keyword">function</span>(<span class="params">err, rows, fields</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (err) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'Query ['</span> + queryString + <span class="string">'] failed: '</span>, err);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            debug(<span class="string">'query success. rows: '</span>, rows.length);</div><div class="line">            <span class="keyword">if</span> (rows &amp;&amp; rows.length &gt;= <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">var</span> new_data = &#123;&#125;;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; rows.length; i++) &#123;</div><div class="line">                    <span class="keyword">var</span> row = &#123;&#125;;</div><div class="line">                    <span class="keyword">var</span> row_key = <span class="string">'time'</span>;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> field <span class="keyword">in</span> rows[i]) &#123;</div><div class="line">                        <span class="keyword">var</span> value = rows[i][field];</div><div class="line">                        <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="built_in">Date</span>) &#123;</div><div class="line">                            value = value.getTime();</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">if</span> (field === <span class="string">'updateTime'</span>) &#123;</div><div class="line">                            <span class="keyword">if</span> (rows[i][field] &gt; lastUpdate) &#123;</div><div class="line">                                lastUpdate = rows[i][field];</div><div class="line">                            &#125;</div><div class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (field === row_key) &#123;</div><div class="line">                            row_key = value;</div><div class="line">                        &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            row[field] = value;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    new_data[row_key] = row;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">var</span> diff = mergediff(orig_data, new_data);</div><div class="line">                <span class="keyword">if</span> (diff.needUpdate) &#123;</div><div class="line">                    pushUpdate(diff.data);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;dataSync(conn, orig_data, lastUpdate);&#125;, <span class="number">1000</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">app.listen(<span class="number">80</span>);</div><div class="line"></div><div class="line"><span class="comment">// cache </span></div><div class="line"><span class="keyword">var</span> data = &#123;&#125;;</div><div class="line"></div><div class="line"><span class="comment">// start data sychonization</span></div><div class="line">dataSync(conn, data, <span class="number">0</span>);</div><div class="line"></div><div class="line"><span class="comment">// send complete data at the first connect</span></div><div class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</div><div class="line">    socket.emit(<span class="string">'completeData'</span>, data);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// push new data</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">pushUpdate</span>(<span class="params">new_data</span>) </span>&#123;</div><div class="line">    io.sockets.emit(<span class="string">'dataUpdate'</span>, new_data);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Client-Side"><a href="#Client-Side" class="headerlink" title="Client Side"></a>Client Side</h2><p>Please see the corresponding code for the client as below. <a href="http://http://www.highcharts.com/" target="_blank" rel="external">Highcharts</a> a good choice for dynamic charts.</p>
<figure class="highlight html"><figcaption><span>index.html</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!doctype html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Dashboard<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line">        #hchart &#123;</div><div class="line">            width: 800px;</div><div class="line">            height: 500px;</div><div class="line">            border: 1px solid #bbb</div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://code.highcharts.com/highcharts.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"socket.io.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="keyword">var</span> socket = io(<span class="string">'http://xx.xx.xx.xx'</span>);</div><div class="line">        <span class="keyword">var</span> hchart = <span class="literal">null</span>;</div><div class="line">        socket.on(<span class="string">'completeData'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'complete-data'</span>).innerHTML = <span class="built_in">JSON</span>.stringify(data);</div><div class="line"></div><div class="line">            <span class="keyword">var</span> series = &#123;&#125;;</div><div class="line">            series.name = <span class="string">'KPI'</span>;</div><div class="line">            series.data = [];</div><div class="line">            <span class="built_in">Object</span>.keys(data).sort().forEach(<span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span> (data.hasOwnProperty(key)) &#123;</div><div class="line">                    <span class="keyword">var</span> point = &#123;&#125;;</div><div class="line">                    point.x = key;</div><div class="line">                    point.y = data[key].value;</div><div class="line">                    series.data.push(point);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">            $(<span class="string">'#hchart'</span>).highcharts(&#123;</div><div class="line">                <span class="attr">chart</span>: &#123;</div><div class="line">                    <span class="attr">type</span>: <span class="string">'spline'</span>,</div><div class="line">                    <span class="attr">animation</span>: Highcharts.svg, <span class="comment">// don't animate in old IE</span></div><div class="line">                    marginRight: <span class="number">10</span>,</div><div class="line">                    <span class="attr">events</span>: &#123;</div><div class="line">                        <span class="attr">load</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                            hchart = <span class="keyword">this</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;,</div><div class="line">                <span class="attr">colors</span>: [<span class="string">'#7cb5ec'</span>, <span class="string">'#ff8528'</span>, <span class="string">'#90ed7d'</span>, <span class="string">'#f7a35c'</span>, <span class="string">'#8085e9'</span>,</div><div class="line">                    <span class="string">'#f15c80'</span>, <span class="string">'#e4d354'</span>, <span class="string">'#8085e8'</span>, <span class="string">'#8d4653'</span>, <span class="string">'#91e8e1'</span>],</div><div class="line">                <span class="attr">title</span>: &#123;</div><div class="line">                    <span class="attr">text</span>: <span class="string">'Example'</span></div><div class="line">                &#125;,</div><div class="line">                <span class="attr">xAxis</span>: &#123;</div><div class="line">                    <span class="attr">type</span>: <span class="string">'datetime'</span>,</div><div class="line">                    <span class="attr">tickPixelInterval</span>: <span class="number">150</span></div><div class="line">                &#125;,</div><div class="line">                <span class="attr">yAxis</span>: &#123;</div><div class="line">                    <span class="attr">title</span>: &#123;</div><div class="line">                        <span class="attr">text</span>: <span class="string">'Value'</span></div><div class="line">                    &#125;,</div><div class="line">                    <span class="attr">plotLines</span>: [&#123;</div><div class="line">                        <span class="attr">value</span>: <span class="number">0</span>,</div><div class="line">                        <span class="attr">width</span>: <span class="number">1</span>,</div><div class="line">                        <span class="attr">color</span>: <span class="string">'#808080'</span></div><div class="line">                    &#125;]</div><div class="line">                &#125;,</div><div class="line">                <span class="attr">tooltip</span>: &#123;</div><div class="line">                    <span class="attr">formatter</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                        <span class="keyword">return</span> <span class="string">'&lt;b&gt;'</span> + <span class="keyword">this</span>.series.name + <span class="string">'&lt;/b&gt;&lt;br/&gt;'</span> +</div><div class="line">                            Highcharts.dateFormat(<span class="string">'%Y-%m-%d %H:%M:%S'</span>, <span class="keyword">this</span>.x) + <span class="string">'&lt;br/&gt;'</span> +</div><div class="line">                            Highcharts.numberFormat(<span class="keyword">this</span>.y, <span class="number">2</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;,</div><div class="line">                <span class="attr">legend</span>: &#123;</div><div class="line">                    <span class="attr">enabled</span>: <span class="literal">true</span></div><div class="line">                &#125;,</div><div class="line">                <span class="attr">exporting</span>: &#123;</div><div class="line">                    <span class="attr">enabled</span>: <span class="literal">false</span></div><div class="line">                &#125;,</div><div class="line">                <span class="attr">series</span>: [series],</div><div class="line">                <span class="attr">credits</span>: &#123;</div><div class="line">                    <span class="attr">enabled</span>: <span class="literal">false</span></div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;);</div><div class="line">        socket.on(<span class="string">'dataUpdate'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">'updated-data'</span>).innerHTML += <span class="built_in">JSON</span>.stringify(data) + <span class="string">"\n"</span>;</div><div class="line"></div><div class="line">            <span class="keyword">var</span> series = hchart.series[<span class="number">0</span>].data;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> data) &#123;</div><div class="line">                <span class="keyword">if</span> (data.hasOwnProperty(key)) &#123;</div><div class="line">                    <span class="keyword">var</span> bOld = <span class="literal">false</span>;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; series.length; i++) &#123;</div><div class="line">                        <span class="keyword">if</span> (series[i].x === key) &#123;</div><div class="line">                            bOld = <span class="literal">true</span>;</div><div class="line">                            series[i].update(data[key].value);</div><div class="line">                            <span class="keyword">break</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">if</span> (!bOld) &#123;</div><div class="line">                        <span class="built_in">console</span>.log(<span class="string">'new point'</span>);</div><div class="line">                        hchart.series[<span class="number">0</span>].addPoint([<span class="built_in">parseInt</span>(key), data[key].value], <span class="literal">true</span>, <span class="literal">true</span>);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Real-time Dashboard<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'hchart'</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Initial Data<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">pre</span> <span class="attr">id</span>=<span class="string">'complete-data'</span>&gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Data Updates<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">pre</span> <span class="attr">id</span>=<span class="string">'updated-data'</span>&gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h1 id="System-Design"><a href="#System-Design" class="headerlink" title="System Design"></a>System Design</h1><p>Now we consider a generic real-time web analytics system, with which we can easily add more charts and configure different data sources.</p>
<h2 id="Rooms"><a href="#Rooms" class="headerlink" title="Rooms"></a>Rooms</h2><p>The largest problem in the example above is that the server simply pushes all the data updates to all the clients. 
In the real use case, each user only view one dashboard at a time, so how to send data only to those clients that have opened the related dashboards?
Socket.ioâ€™s <a href="http://socket.io/docs/rooms-and-namespaces/" target="_blank" rel="external">Rooms and Namespaces</a> can solve this problem easily. 
We can change the above code like this to support rooms (not runnable, just to show the concept):
<figure class="highlight javascript"><figcaption><span>Server Side</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">io.sockets.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</div><div class="line">    socket.on(<span class="string">'join'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">        <span class="comment">//leave all existing rooms</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; socket.rooms.length; i++) &#123;</div><div class="line">            debug(<span class="string">'leave:'</span>, socket.rooms[i]);</div><div class="line">            socket.leave(socket.rooms[i]);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//join the new room</span></div><div class="line">        debug(<span class="string">'join:'</span>, event.room);</div><div class="line">        socket.join(event.room);</div><div class="line"></div><div class="line">        <span class="comment">// send complete data when joining a room</span></div><div class="line">        socket.emit(<span class="string">'completeData'</span>, getRoomData(event.room));</div><div class="line">    &#125;)</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// push new data</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">pushUpdate</span>(<span class="params">new_data</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> sockets = <span class="literal">null</span>;</div><div class="line"></div><div class="line">    <span class="comment">//a room list that needs this data</span></div><div class="line">    <span class="keyword">var</span> registered_rooms = <span class="keyword">this</span>.query.registered_rooms;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; registered_rooms.length; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (sockets == <span class="literal">null</span>) &#123;</div><div class="line">            sockets = io.to(registered_rooms[i]);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            sockets = sockets.to(registered_rooms[i]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    sockets.emit(<span class="string">'dataUpdate'</span>, &#123;<span class="attr">name</span>: <span class="keyword">this</span>.query.name, <span class="attr">data</span>: new_data&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="DataSychonizer"><a href="#DataSychonizer" class="headerlink" title="DataSychonizer"></a>DataSychonizer</h2><p>Then we need to decouple all these stuff, first create a class to handle the data sychonization for each query. 
This one can only handle MySQL queries, but you can continue the decoupling to support more databases.
<figure class="highlight javascript"><figcaption><span>DataSynchronizor</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> debug = <span class="built_in">require</span>(<span class="string">'debug'</span>)(<span class="string">'DataSync'</span>);</div><div class="line"><span class="keyword">var</span> g_mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">orig, extended</span>) </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> extended) &#123;</div><div class="line">        <span class="keyword">if</span> (orig.hasOwnProperty(key)) &#123;</div><div class="line">            orig[key] = extended[key]</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">DataSynchronizer</span>(<span class="params">dbconfig, query, options, onUpdateFun</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.dbconfig = dbconfig || g_dbconfig;</div><div class="line">    <span class="keyword">this</span>.connection = g_mysql.createConnection(<span class="keyword">this</span>.dbconfig);</div><div class="line">    <span class="keyword">this</span>.query = query;</div><div class="line">    <span class="keyword">this</span>.options = &#123;</div><div class="line">        <span class="attr">connect_retry_timeout</span>: <span class="number">2000</span>,</div><div class="line">        <span class="attr">data_refresh_interval</span>: <span class="number">3000</span></div><div class="line">    &#125;;</div><div class="line">    extend(<span class="keyword">this</span>.options, options||&#123;&#125;);</div><div class="line">    <span class="keyword">this</span>.data = &#123;&#125;;</div><div class="line">    <span class="keyword">this</span>.onUpdateFun = onUpdateFun || <span class="literal">null</span>;</div><div class="line">    <span class="keyword">this</span>.lastUpdateTime = <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">DataSynchronizer.prototype.mergediff = <span class="function"><span class="keyword">function</span>(<span class="params">new_data</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> diff = &#123;<span class="attr">needUpdate</span>:<span class="literal">false</span>, <span class="attr">data</span>:&#123;&#125;&#125;;</div><div class="line">    <span class="keyword">var</span> diff_data = diff.data;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> new_data) &#123;</div><div class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.data.hasOwnProperty(key) || <span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.data[key])!== <span class="built_in">JSON</span>.stringify(new_data[key])) &#123;</div><div class="line">            diff.needUpdate = <span class="literal">true</span>;</div><div class="line">            <span class="keyword">this</span>.data[key] = new_data[key];</div><div class="line">            diff_data[key] = new_data[key];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.query.num &amp;&amp; <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.data).length &gt; <span class="keyword">this</span>.query.num) &#123;</div><div class="line">        <span class="keyword">var</span> ordered = <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.data).sort();</div><div class="line">        <span class="keyword">var</span> delNum = ordered.length - <span class="keyword">this</span>.query.num;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; delNum; i++) &#123;</div><div class="line">            <span class="keyword">delete</span> <span class="keyword">this</span>.data[ordered[i]];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> diff;</div><div class="line">&#125;</div><div class="line"></div><div class="line">DataSynchronizer.prototype.start = <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> obj = arg||<span class="keyword">this</span>;</div><div class="line">    debug(g_mysql.format(<span class="keyword">this</span>.query.query_string, <span class="keyword">this</span>.lastUpdateTime));</div><div class="line">    <span class="keyword">this</span>.connection.query(g_mysql.format(<span class="keyword">this</span>.query.query_string, <span class="keyword">this</span>.lastUpdateTime), <span class="function"><span class="keyword">function</span>(<span class="params">err, rows, fields</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (err) &#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'Query ['</span> + obj.query.query_string + <span class="string">'] failed: '</span>, err);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            debug(<span class="string">'query success. rows: '</span>, rows.length);</div><div class="line">            <span class="keyword">if</span> (rows &amp;&amp; rows.length &gt;= <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">var</span> new_data = &#123;&#125;;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; rows.length; i++)</div><div class="line">                &#123;</div><div class="line">                    <span class="keyword">var</span> row = &#123;&#125;;  <span class="keyword">var</span> row_key = <span class="string">''</span>;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> field <span class="keyword">in</span> rows[i]) &#123;</div><div class="line">                        <span class="keyword">var</span> value = rows[i][field];</div><div class="line">                        <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="built_in">Date</span>) &#123;</div><div class="line">                            value = value.getTime();</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">if</span> (field === <span class="string">'updateTime'</span>) &#123;</div><div class="line">                            <span class="keyword">if</span> (rows[i][field] &gt; obj.lastUpdateTime) &#123;</div><div class="line">                                obj.lastUpdateTime = rows[i][field];</div><div class="line">                            &#125;</div><div class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (field === obj.query.key) &#123;</div><div class="line">                            row_key = value;</div><div class="line">                        &#125; <span class="keyword">else</span> &#123;</div><div class="line">                            row[field] = value;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    new_data[row_key] = row;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">var</span> diff = obj.mergediff(new_data);</div><div class="line">                <span class="comment">//debug(diff);</span></div><div class="line">                <span class="keyword">if</span> (diff.needUpdate) &#123;</div><div class="line">                    obj.onUpdateFun(diff.data);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;obj.start(obj)&#125;, obj.options.data_refresh_interval);</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = DataSynchronizer;</div></pre></td></tr></table></figure></p>
<h2 id="Data-Model"><a href="#Data-Model" class="headerlink" title="Data Model"></a>Data Model</h2><p>Each room represents a chart. Each chart contains several series. Each series has a <code>DataSynchronizer</code>. 
Different charts can have common data series, thus each <code>DataSynchronizer</code> should be registered to several rooms. 
As for the user authorizations, you can bind them with charts or even series, depends on your needs.</p>
<p>Going into too much details is not the purpose of this article, Iâ€™d better publish a open-source project with my work later. 
Thanks for reading. :)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xingwu.me/2014/10/19/Real-time-Web-Dashboard-Using-Socket-io-and-Highcharts/" data-id="cixny1n45000g07pgdy0epfil" class="article-share-link">Share</a>
      
        <a href="http://xingwu.me/2014/10/19/Real-time-Web-Dashboard-Using-Socket-io-and-Highcharts/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Chart/">Chart</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node-js/">Node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Real-time/">Real-time</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Socket-io/">Socket.io</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/">Web</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/11/04/Stop-Bootstrap-Carousel-from-Auto-sliding-at-the-Last-Slide/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Stop Bootstrap Carousel from Auto-sliding at the Last Slide
        
      </div>
    </a>
  
  
    <a href="/2014/10/15/Spark-Streaming-Troubleshooting/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Spark Streaming Troubleshooting</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          
            <aside id="sidebar" class="fixed">
    <div class="widget-wrap fixed">
    <h3 class="widget-title">Anchors</h3>

    <div class="widget">
        <ul class='toc'>
        <li><a class='anchor' href='#logo'>Title</a></li>
        <li><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Quick-Start"><span class="toc-number">1.</span> <span class="toc-text">Quick Start</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Server-Side"><span class="toc-number">1.1.</span> <span class="toc-text">Server Side</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Client-Side"><span class="toc-number">1.2.</span> <span class="toc-text">Client Side</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#System-Design"><span class="toc-number">2.</span> <span class="toc-text">System Design</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Rooms"><span class="toc-number">2.1.</span> <span class="toc-text">Rooms</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DataSychonizer"><span class="toc-number">2.2.</span> <span class="toc-text">DataSychonizer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Data-Model"><span class="toc-number">2.3.</span> <span class="toc-text">Data Model</span></a></li></ol></li></ol></li>
        <li><a class='anchor' href='#comments'>Comments</a></li> 
        </ul>
    </div>
</div>
    
    <div class="widget-wrap">
      <h3 class="widget-title">Related</h3>
      <div class="widget recents">
        <ul>
  
    <li>
      <a href="/2014/11/04/Stop-Bootstrap-Carousel-from-Auto-sliding-at-the-Last-Slide/">Stop Bootstrap Carousel from Auto-sliding at the Last Slide</a>
    </li>
  
    <li>
      <a href="/2014/10/13/Using-Google-Maps-API-to-Implement-a-Two-dimension-Heatmap-like-Tableau/">Using Google Maps API to Implement a Two-dimensional Circle Heatmap like Tableau</a>
    </li>
  
        </ul>
      </div>
    </div>

</aside>
          
        
      </div>
      <div id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a></br>
      &copy; 2017 Xing Wu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</div>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    
<script>
  var disqus_shortname = 'xingwu';
  
  var disqus_url = 'http://xingwu.me/2014/10/19/Real-time-Web-Dashboard-Using-Socket-io-and-Highcharts/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

    <a href='#logo' id='btn-btt'>^</a>
  </div>
</body>
</html>